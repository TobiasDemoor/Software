Un área donde [[UDP]] se utiliza mucho es en las aplicaciones multimedia en tiempo real. A raíz de esto fue que nació el **RTP (Real-time Transport Protocol)**. Se describe en el [[RFC]] 3550 y ahora se utiliza ampliamente para aplicaciones multimedia. 

![[RTP_1.png]]

Por lo general, RTP se ejecuta en espacio de usuario sobre UDP (en el sistema operativo). Opera como se muestra a continuación. La aplicación multimedia consiste en múltiples flujos de audio, video, texto y quizás otros flujos. Éstos se colocan en la biblioteca RTP, la cual está en el espacio de usuario junto con la aplicación. Esta biblioteca multiplexa los flujos y los codifica en paquetes RTP, que después coloca en un socket. En el extremo del socket correspondiente al sistema operativo, se generan paquetes UDP para envolver los paquetes RTP y se entregan al IP para que los transmita a través de un enlace tal como Ethernet. En el receptor se lleva a cabo el proceso inverso. En un momento dado la aplicación multimedia recibirá datos multimedia de la biblioteca RTP. Es responsable de reproducir los medios.

Como consecuencia de este diseño, es un poco difícil saber en cuál capa está RTP. Debido a que se ejecuta en el espacio de usuario y está enlazado al programa de aplicación, sin duda luce como un protocolo de aplicación. Por otro lado, es un protocolo genérico, independiente de la aplicación que simplemente proporciona herramientas de transporte, por lo que se parece también a un protocolo de transporte. Tal vez la mejor descripción sea que es un protocolo de transporte que sólo está implementado en la capa de aplicación.

La función básica de RTP es multiplexar varios flujos de datos de tiempo real en un solo flujo de paquetes UDP. El flujo UDP se puede enviar a un solo destino (unidifusión) o a múltiples destinos (multidifusión). Debido a que RTP sólo utiliza UDP normal, los enrutadores no dan a sus paquetes un trato especial, a menos que se habiliten algunas características de calidad de servicio IP normales. En particular no hay garantías especiales acerca de la entrega, así que los paquetes se pueden perder, retrasar, corromper, etcétera.

El formato de RTP contiene varias características para ayudar a que los receptores trabajen con información multimedia. A cada paquete enviado en un flujo RTP se le da un número más grande que a su predecesor. Esta numeración permite al destino determinar si falta algún paquete en cuyo caso, la mejor acción a realizar queda a criterio de la aplicación. Tal vez esta acción sea omitir una trama de video si los paquetes transportan datos de video, o aproximar el valor faltante mediante la interpolación en caso de que los paquetes transporten datos de audio. La retransmisión no es una opción práctica debido a la probabilidad de que el paquete retransmitido llegue muy tarde como para ser útil. Como consecuencia, RTP no tiene confirmaciones de recepción ni ningún mecanismo para solicitar retransmisiones.

Las estampas de tiempo (timestamping) son otra herramienta que muchas de las aplicaciones en tiempo real necesitan. La idea aquí es permitir que la fuente asocie una estampa de tiempo con la primera muestra de cada paquete. Las estampas de tiempo son relativas al inicio del flujo, por lo que sólo son importantes las diferencias entre dichas estampas. Los valores absolutos no tienen significado. Este mecanismo permite que el destino haga un uso muy moderado del almacenamiento en búfer y reproduzca cada muestra el número exacto de milisegundos después del inicio del flujo, sin importar cuándo llegó el paquete que contiene la muestra.

La estampa de tiempo no sólo reduce los efectos de la variación en el retardo de la red, sino que también permite que múltiples flujos estén sincronizados entre sí. Por ejemplo, un programa de televisión digital podría tener un flujo de video y dos flujos de audio. Los dos flujos de audio podrían ser para difusiones en estéreo o para manejar películas con la banda sonora del idioma original y con una “traducción” al idioma local, para darle una opción al espectador. Cada flujo proviene de un dispositivo físico diferente, pero si tienen estampas de tiempo de un solo contador, se pueden reproducir de manera síncrona, incluso si los flujos se transmiten o reciben de manera irregular.

El encabezado RTP consiste de tres palabras de 32 bits y potencialmente de algunas extensiones. La primera palabra contiene el campo *Versión*, que actualmente es la 2. Esperemos que esta versión esté muy cerca de la última debido a que sólo quedó pendiente un punto del código (aunque se puede definir como 3 para indicar que la versión real estaba en una palabra de extensión).

El bit *P* indica que el paquete se ha rellenado para formar un múltiplo de 4 bytes. El último byte de relleno indica cuántos bytes se agregaron. El bit *X* indica que hay un encabezado de extensión. El formato y el significado de este encabezado no se definen. Lo único que se define es que la primera palabra de la extensión proporciona la longitud. Ésta es una puerta de escape para cualquier requerimiento imprevisto

![[RTP_encabezado.png]]

El campo *CC* indica cuántas fuentes de contribución están presentes, de 0 a 15 (vea abajo). El bit *M* es un bit marcador específico de la aplicación. Puede utilizarse para marcar el inicio de una trama de video, el inicio de una palabra en un canal de audio o algo más que la aplicación entienda. El campo *Tipo de carga útil* indica cuál algoritmo de codificación se utilizó (por ejemplo, audio de 8 bits sin compresión, MP3, etc.). Puesto que cada paquete lleva este campo, la codificación puede cambiar durante la transmisión. El *Número de secuencia* es simplemente un contador que se incrementa con cada paquete RTP enviado. Se utiliza para detectar paquetes perdidos.

La fuente del flujo produce la *Estampa de tiempo* para indicar cuándo se creó la primera muestra en el paquete. Este valor puede ayudar a reducir la variabilidad de la sincronización conocida como **variación del retardo (jitter)** en el receptor, al desacoplar la reproducción del tiempo de llegada del paquete. El *Identificador de origen de sincronización* indica a cuál flujo pertenece el paquete. Es el método utilizado para multiplexar y desmultiplexar varios flujos de datos en un solo flujo de paquetes UDP. Por último, los *Identificadores de origen de contribución*, en caso de que haya, se utilizan cuando hay mezcladoras en el estudio. En ese caso, la mezcladora es el origen de la sincronización y los flujos que se mezclan se listan aquí.
**NAT o Network Adress Translation** es una técnica que traduce [[direcciones IP]] privadas a direcciones públicas. Busca solucionar de alguna manera el agotamiento de direcciones [[IP|IPv4]]. Se encuentra definida en el [[RFC]] 3022.

La idea básica detrás de NAT es que el ISP asigne a cada hogar o negocio una sola dirección IP para el tráfico de [[Internet]]. Dentro de la red del cliente, cada computadora obtiene una dirección IP única, la cual se utiliza para enrutar el tráfico interno. Sin embargo, justo antes de que un paquete salga de la red del cliente y vaya al ISP, la dirección IP única interna se traduce a la dirección IP pública compartida. Esta traducción hace uso de los tres rangos de direcciones IP que se han declarado como privados. Las redes pueden utilizarlos de manera interna como deseen. La única regla es que no pueden aparecer paquetes que contengan estas mismas direcciones en Internet. Los tres rangos reservados son:
- 10.0.0.0 - 10.255.255.255/8 (16,777,216 hosts) 
- 172.16.0.0 - 172.31.255.255/12 (1,048,576 hosts) 
- 192.168.0.0 - 192.168.255.255/16 (65,536 hosts)

Dentro de las premisas del cliente, cada máquina tiene una dirección única de la forma (por ejemplo) 10.x.y.z. Sin embargo, antes de que un paquete salga de las premisas del cliente, pasa a través de una **caja NAT** que convierte la dirección IP de origen interna, 10.0.0.1 en la figura, a la dirección IP verdadera del cliente, 198.60.42.12 en este ejemplo. A menudo, la caja NAT se combina en un solo dispositivo con un [[firewall]] que proporciona seguridad controlando cuidadosamente lo que entra y sale por la red.

![[NAT.png]]

Ahora, cuando la respuesta vuelve se dirige naturalmente a la IP pública asignada a la caja NAT, por lo que, ¿cómo sabe esta con qué dirección interna se reemplaza? Aquí está el problema con NAT. Si hubiera un campo extra en el encabezado IP, ese campo podría usarse para guardar el registro del emisor real, pero sólo queda 1 bit sin usar. En principio, podría crearse una nueva opción para mantener la verdadera dirección de origen, pero para ello habría que cambiar el código IP en todas las máquinas de todo Internet para manejar la nueva opción

Lo que realmente pasa es lo siguiente. Los diseñadores de NAT observaron que la mayoría de los paquetes IP llevan cargas útiles de [[TCP]] o [[UDP]]. Cuando un proceso desea establecer una conexión TCP con un proceso remoto, se conecta a un puerto TCP sin usar en su propia máquina. Éste se conoce como **puerto de origen** y le indica al código TCP dónde enviar los paquetes entrantes que pertenecen a esta conexión. El proceso también proporciona un **puerto de destino** para indicar a quién se deben dar los paquetes en el lado remoto.

Si utilizamos el campo Puerto de origen, podemos resolver nuestro problema de asignación. Siempre que un paquete de salida entra en la caja NAT, la dirección de origen 10.x.y.z se reemplaza por la verdadera dirección IP del cliente. Además, el campo Puerto de origen TCP se reemplaza por un índice en la tabla de traducción de 65 536 entradas de la caja NAT. Esta entrada de la tabla contiene el puerto de origen y la dirección IP originales. Finalmente, las sumas de verificación de los encabezados IP y TCP se recalculan e insertan en el paquete. Es necesario reemplazar el Puerto de origen, porque podría ocurrir que ambas conexiones de las máquinas 10.0.0.1 y 10.0.0.2 usaran el puerto 5 000, por ejemplo, así que el Puerto de origen no basta por sí solo para identificar el proceso de envío.

Cuando un paquete llega a la caja NAT desde el ISP, el Puerto de origen en el encabezado TCP se extrae y utiliza como un índice en la tabla de asignación de la caja NAT. Desde la entrada localizada, la dirección IP interna y el Puerto de origen TCP se extraen e insertan en el paquete. Luego, las sumas de verificación de IP y TCP se recalculan e insertan en el paquete. Entonces el paquete se pasa al enrutador del cliente para su entrega normal mediante el uso de la dirección 10.x.y.z.

Aunque este tipo de esquema resuelve el problema, muchos puristas en la comunidad de IP lo consideran a primera vista como una abominación. He aquí algunas de las objeciones sintetizadas brevemente. Primero, **NAT viola el modelo arquitectónico de IP**, el cual establece que cada dirección IP identifica a una sola máquina en forma única y a nivel mundial. Toda la estructura del software de Internet se basa en este hecho. Con NAT, miles de máquinas pueden usar (y lo hacen) la dirección 10.0.0.1.

Segundo, **NAT quebranta el modelo de conectividad de extremo a extremo de Internet**, que establece que cualquier host puede enviar un paquete a cualquier otro en cualquier momento dado. Como la asignación en la caja NAT se establece mediante los paquetes de salida, no se pueden aceptar paquetes entrantes sino hasta después de los paquetes de salida. En la práctica, esto significa que un usuario doméstico con NAT puede hacer conexiones TCP/IP a un servidor web remoto, pero un usuario remoto no puede hacer conexiones a un servidor de juego en la red doméstica. Se requiere una configuración especial o técnicas de NAT transversal para soportar este tipo de situación.

Tercero, **NAT cambia a Internet de una red sin conexión a un tipo especial de red orientada a conexión**. El problema es que la caja NAT debe mantener la información (es decir, la asignación) para cada conexión que pasa a través de ella. Hacer que la red mantenga el estado de la conexión es una propiedad de las redes orientadas a conexión, no de las redes sin conexión. Si la caja NAT falla y se pierde su tabla de asignación, se destruirán todas sus conexiones TCP. En ausencia de NAT, un enrutador puede fallar y reiniciarse sin un efecto a largo plazo sobre las conexiones TCP. El proceso de envío apenas queda fuera unos segundos y retransmite todos los paquetes cuya recepción no se haya confirmado. Con NAT, Internet es tan vulnerable como una red de circuitos conmutados.

Cuarto, **NAT viola la regla más fundamental de los protocolos distribuidos en capas: la capa k no puede hacer ninguna suposición acerca de lo que la capa k + 1 ha puesto en el campo de carga útil**. Este principio básico está ahí para que las capas sigan siendo independientes. Si TCP se actualiza después a TCP-2, con un diseño de encabezado diferente (por ejemplo, puertos de 32 bits), NAT fallará. Toda la idea de los protocolos distribuidos en capas es asegurar que los cambios en una capa no requieran cambios en otras capas. NAT destruye esta independencia.

Quinto, **NAT exige el uso de TCP y UDP para funcionar**. En Internet no se exige que los procesos utilicen TCP o UDP, si un usuario en la máquina A decide usar algún nuevo protocolo de transporte para hablar con un usuario en la máquina B (por ejemplo, para una aplicación multimedia), la introducción de una caja NAT hará que la aplicación falle, ya que la caja NAT no podrá localizar el Puerto de origen TCP de forma correcta.

Un sexto problema relacionado consiste en que algunas aplicaciones usan múltiples conexiones TCP/ IP o puertos UDP en las formas prescritas. Por ejemplo, el FTP (File Transfer Protocol) inserta direcciones IP en el cuerpo del paquete para que el receptor las extraiga y utilice. Como NAT no sabe nada sobre estos arreglos, no puede reescribir las direcciones IP ni justificarlas de alguna otra forma. Esta falta de entendimiento significa que FTP y otras aplicaciones pueden fallar en presencia de NAT, a menos que se tomen precauciones especiales. A menudo es posible arreglar NAT para estos casos, pero no es una buena idea tener que arreglar el código en la caja NAT cada vez que surge una nueva aplicación.

Por último, debido a que el campo Puerto de origen de TCP es de 16 bits, **a lo sumo se pueden asignar 65536 máquinas a una dirección IP**. En realidad, el número es ligeramente menor porque los primeros 4 096 puertos se reservan para usos especiales. Pero si hay varias direcciones IP disponibles, cada una puede manejar hasta 61 440 máquinas.

De estos nombrados anteriormente se consideran los tres principales:
- NAT viola el modelo arquitectónico de IP 
- NAT quebranta el modelo de conectividad de extremo a extremo 
- NAT cambia a Internet de una red sin conexión a un tipo especial de red orientada a la conexión

En el RFC 2993 se explican éstos y otros problemas con NAT. A pesar de estas cuestiones, NAT se utiliza mucho en la práctica, en especial para las redes domésticas y de negocios pequeños, como la única técnica conveniente para lidiar con la escasez de direcciones IP. Se ha visto envuelta con los firewalls y la privacidad debido a que bloquea de manera predeterminada los paquetes entrantes no solicitados. Por esta razón es muy poco probable que desaparezca, incluso aunque el IPv6 se implemente de manera amplia.
Capa 2 del [[Modelo OSI]]

La principal tarea de la **capa de enlace de datos** es transformar un medio de transmisión puro en una línea que esté libre de errores de transmisión. Enmascara los errores reales, de manera que la capa de red no los vea. Para lograr esta tarea, el emisor divide los datos de entrada en **tramas de datos** (por lo general, de algunos cientos o miles de bytes) y transmite las tramas en forma secuencial. Si el servicio es confiable, para confirmar la recepción correcta de cada trama, el receptor devuelve una **trama de confirmación de recepción**. ^extracto

Otra cuestión que surge en la capa de enlace de datos (y en la mayoría de las capas superiores) es cómo evitar que un transmisor rápido inunde de datos a un receptor lento. Tal vez sea necesario algún mecanismo de regulación de tráfico para notificar al transmisor cuando el receptor puede aceptar más datos.

![[Subcapa de Control de Acceso al Medio#^extracto]]

La capa de enlace de datos implementa algoritmos para lograr una comunicación confiable y eficiente de unidades completas de información llamadas **tramas** entre dos máquinas adyacentes. Por adyacente, se quiere decir que las dos máquinas están concectadas mediante un canal de comunicaciones que actúa de manera conceptual como un alambre. La propiedad esencial del canal que lo hace asemejarse a un alambre es que los bits se entregan en el mismo orden que es enviaron.

## Cuestiones de diseño
La capa de enlace de datos utiliza los servicios de la [[Capa física|capa física]] para enviar y recibir bits a través de los canales de comunicación. Tiene varias funciones específicas, entre las que se incluyen:
1. Proporcionar a la capa de red una [[Interfaz|interfaz]] de servicio bien definida.
2. Manejar los errores de transmisión. 
3. Regular el flujo de datos para que los emisores rápidos no saturen a los receptores lentos.

Para cumplir con estas metas, la capa de enlace de datos toma los paquetes que obtiene de la [[Capa de red|capa de red]] y los encapsula en tramas para transmitirlos. Cada trama contiene un encabezado, un campo de carga útil (payload) para almacenar el paquete y un terminador, como se muestra en la figura 3-1. El manejo de las tramas es la tarea más importante de la capa de enlace de datos.

![[capa_de_enlace_de_datos_1.png]]

### Servicios proporcionados a la capa de red
La función de la capa de enlace de datos es proveer servicios a la [[Capa de red|capa de red]]. El servicio principal es la transferencia de datos de la capa de red en la máquina de origen, a la capa de red en la máquina de destino. En la capa de red de la máquina de origen está una entidad, llamada [[Proceso|proceso]], que entrega algunos bits a la capa de enlace de datos para que los transmita al destino. La tarea de la capa de enlace de datos es transmitir los bits a la máquina de destino, de modo que se puedan entregar a la capa de red de esa máquina.

La capa de enlace de datos puede diseñarse para ofrecer varios servicios. Los servicios reales ofrecidos varían de un protocolo a otro. Tres posibilidades razonables que normalmente se proporcionan son: 
1. **Servicio sin conexión ni confirmación de recepción**: consiste en hacer que la máquina origen envía tramas independientes a la máquina de destino sin que ésta confime la recepción. Un ejemplo de esto es [[Ethernet]]. No se establece una conexión lógica de antemano ni se libera después. Esta clase de servicio es apropiada cuando la tasa de error es muy baja. También es apropiada para el tráfico en tiempo real, como el de voz, en donde es peor tener retraso en los datos que errores en ellos.
2. Servicio sin conexión con confirmación de recepción: cuanod se ofrece este servicio tampoco se utilizan conexiones lógicas, pero se confirma de manera individual la recepción de cada trama enviada. De esta manera, el emisor sabe si la trama llegó bien o se perdió. Si no ha llegado en un intervalo especificado, se puede enviar de nuevo. Este servicio es útil en canales no confiables, como los de los sistemas inalámbricos. 802.11 ([[WiFi]]) es un buen ejemplo de esta clase de servicio.
3. Servicio orientado a conexión con confirmación de recepción: con este servicio, las máquinas de origen y de destino establecen una conexión antes de transferir datos. Cada trama enviada a través de la conexión está numerada, y la capa de enlace de datos garantiza que cada trama enviada llegará a su destino. Es más, garantiza que cada trama se recibirá exactamente una vez y que todas las tramas se recibirán en el orden correcto. Así, el servicio orientado a conexión ofrece a los procesos de la capa de red el equivalente a un flujo de bits confiable. Es apropiado usarlo en enlaces largos y no confiables, como un canal de satélite o un circuito telefónico de larga distancia. Si se utilizara el servicio no orientado a conexión con confirmación de recepción, es posible que las confirmaciones de recepción perdidas ocasionaran que una trama se enviara y recibiera varias veces, desperdiciando ancho de banda.

### Entramado
Para proveer servicio a la [[Capa de red|capa de red]], la capa de enlace de datos debe usar el servicio que la [[Capa física|capa física]] le proporciona. Lo que hace la capa física es aceptar un flujo de bits puros y tratar de entregarlo al destino. Si el canal es [[Ruido|ruidoso]], como en la mayoría de los enlaces inalámbricos y en algunos alámbricos, la capa física agregará cierta redundancia a sus señales para reducir la tasa de error de bits a un nivel tolerable. Sin embargo, no se garantiza que el flujo de bits recibido por la capa de enlace de datos esté libre de errores. Algunos bits pueden tener distintos valores y la cantidad de bits recibidos puede ser menor, igual o mayor que la cantidad de bits transmitidos. **Es responsabilidad de la capa de enlace de datos detectar y, de ser necesario, corregir los errores.**

El método común es que la capa de enlace de datos divida el flujo de bits en tramas discretas, calcule un **checksum** para cada trama, e incluya ese checksum en la trama al momento de transmitirla. Cuando una trama llega al destino, se recalcula el checksum. Si el valor calculado es distintp del contenido en la trama, la capa de enlace de datos sabe que ha ocurrido un error y toma las medidas necesarias para manejarlo.

Hay distintos métodos para dividir el flujo de bits en tramas.

#### Conteo de bytes
El primer método de entramado se vale de un campo en el encabezado para especificar el número de bytes en la trama. Cuando la capa de enlace de datos del destino ve el conteo de bytes, sabe cuántos bytes siguen y, por lo tanto, dónde concluye la trama. El problema con este algoritmo es que el conteo se puede alterar debido a un error de transmisión. Por ejemplo, si un conteo de bytes de 5 se vuelve un 7 debido a que cambió un solo bit, el destino perderá la sincronía y entonces será incapaz de localizar el inicio correcto de la siguiente trama. Incluso si el destino sabe que la trama está mal puesto que la suma de verificación es incorrecta, no tiene forma de saber dónde comienza la siguiente trama. Tampoco es útil enviar una trama de vuelta a la fuente para solicitar una retransmisión, ya que el destino no sabe cuántos bytes tiene que saltar para llegar al inicio de la retransmisión. Por esta razón raras veces se utiliza el método de conteo de bytes por sí solo.

#### Bytes bandera con relleno de bytes
El segundo método de entramado evita el problema de volver a sincronizar nuevamente después de un error al hacer que cada trama inicie y termine con bytes especiales. Con frecuencia se utiliza el mismo byte, denominado **byte bandera**, como delimitador inicial y final. Dos bytes bandera consecutivos señalan el final de una trama y el inicio de la siguiente. De esta forma, si el receptor pierde alguna vez la sincronización, todo lo que tiene que hacer es buscar dos bytes bandera para encontrar el fin de la trama actual y el inicio de la siguiente.

Sin embargo, aún queda un problema que tenemos que resolver. Se puede dar el caso de que el byte bandera aparezca en los datos, en especial cuando se transmiten datos binarios como fotografías o canciones. Esta situación interferiría con el entramado. Una forma de resolver este problema es hacer que la capa de enlace de datos del emisor inserte un byte de escape especial (ESCAPE) justo antes de cada byte bandera “accidental” en los datos. De esta forma es posible diferenciar un byte bandera del entramado de uno en los datos mediante la ausencia o presencia de un byte de escape antes del byte bandera. La capa de enlace de datos del lado receptor quita el byte de escape antes de entregar los datos a la capa de red. Esta técnica se llama **relleno de bytes**.

Ahora bien, la siguiente pregunta es: ¿qué sucede si aparece un byte de escape en medio de los datos? La respuesta es que también se rellena con un byte de escape. En el receptor se quita el primer byte de escape y se deja el byte de datos que le sigue (el cual podría ser otro byte de escape, o incluso el byte bandera). En todos los casos, la secuencia de bytes que se entrega después de quitar los bytes de relleno es exactamente la misma que la secuencia de bytes original. Así todavía podemos encontrar un límite de trama si buscamos dos bytes bandera seguidos, sin molestarnos por eliminar los escapes.

#### Bits bandera con relleno de bits
El tercer método de delimitar el flujo de bits resuelve una desventaja del relleno de bytes: que está obligado a usar bytes de 8 bits. También se puede realizar el entramado a nivel de bit, de modo que las tramas puedan contener un número arbitrario de bits compuesto por unidades de cualquier tamaño. Esto se desarrolló para el protocolo **HDLC (High-level Data Link Control)**, que alguna vez fue muy popular. Cada trama empieza y termina con un patrón de bits especial, 01111110 o 0x7E en hexadecimal. Este patrón es un byte bandera. Cada vez que la capa de enlace de datos del emisor encuentra cinco bits 1 consecutivos en los datos, inserta automáticamente un 0 como relleno en el flujo de bits de salida. Este **relleno de bits** es análogo al relleno de bytes, en el cual se inserta un byte de escape en el flujo de caracteres de salida antes de un byte bandera en los datos. Además asegura una densidad mínima de transiciones que ayudan a la capa física a mantener la sincronización. La tecnología USB (Bus Serie Universal, del inglés Universal Serial Bus) usa relleno de bits por esta razón.

Cuando el receptor ve cinco bits 1 de entrada consecutivos, seguidos de un bit 0, extrae (es decir, borra) de manera automática el bit 0 de relleno. Así como el relleno de bytes es completamente transparente para la capa de red en ambas computadoras, también lo es el relleno de bits. Si los datos de usuario contienen el patrón bandera 01111110, éste se transmite como 011111010, pero se almacena en la memoria del receptor como 01111110.

Con el relleno de bits, el límite entre las dos tramas puede ser reconocido sin ambigüedades mediante el patrón bandera. De esta manera, si el receptor pierde la pista de dónde está, todo lo que tiene que hacer es explorar la entrada en busca de secuencias de banderas, pues sólo pueden ocurrir en los límites de las tramas y nunca dentro de los datos.

Un efecto secundario del relleno de bits y de bytes es que la longitud de una trama depende ahora del contenido de los datos que lleva. Por ejemplo, si no hay bytes bandera en los datos, se podrían llevar 100 bytes en una trama de aproximadamente 100 bytes. No obstante, si los datos consisten sólo de bytes bandera, habrá que incluir un byte escape para cada uno de estos bytes y la trama será de cerca de 200 bytes de longitud. Con el relleno de bits, el aumento sería cerca del 12.5%, ya que se agrega 1 bit a cada byte.

#### Violaciones de codificación de la capa física
El último método de entramado es utilizar un atajo desde la capa física. La codificación de bits como señales incluye a menudo redundancia para ayudar al receptor. Esta redundancia significa que algunas señales no ocurrirán en los datos regulares. Por ejemplo, en el código de línea 4B/5B se asignan 4 bits de datos a 5 bits de señal para asegurar suficientes transiciones de bits. Esto significa que no se utilizan 16 de las 32 posibles señales. Podemos usar algunas señales reservadas para indicar el inicio y el fin de las tramas. En efecto, estamos usando “violaciones de código” para delimitar tramas. La belleza de este esquema es que, como hay señales reservadas, es fácil encontrar el inicio y final de las tramas y no hay necesidad de rellenar los datos.

### Control de errores
